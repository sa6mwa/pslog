# TODO

Use descending priority from top to bottom.

- [x] P0 / Chunk 1: Make write failures observable and define close ownership semantics. Scope: propagate runtime write errors (`writer.go`) to logger-level policy, and prevent accidental shared-writer close across cloned loggers. Unit tests: `go test ./... -run 'TestLoggerFromEnvOutputFailure|TestWriterFromEnvOutput|TestLoggerVariants'`. Targeted integration: `go test ./... -run 'TestLoggerFromEnvOutputFile|TestLoggerFromEnvOutputDefaultTee' -count=1`. Regression boundary: all logger modes and output close behavior.
- [x] P0 / Chunk 2: Fix runtime lifecycle hazards (time cache shutdown + ANSI palette concurrency safety). Scope: add stoppable `timeCache` refresh lifecycle and race-safe palette state handling for concurrent logging and palette swaps. Unit tests: `go test ./... -run 'TestTimeCache|TestColor' -count=1 -race`. Targeted integration: `go test ./... -run 'TestLoggerVariants|TestConsoleVariants|TestJSONEmit' -count=1 -race`. Regression boundary: timestamp rendering stability and colored output behavior under concurrency.
- [ ] P0 / Chunk 3: Harden `pslogconsole2json` parsing correctness (type state isolation, DTG validation, malformed-field handling) and add first-class tests. Scope: decouple per-file type tracking, correct DTG month/day semantics, and emit explicit parse errors for malformed field tails. Unit tests: `cd pslogconsole2json && go test ./... -run 'TestTypeTracker|TestParseDTG|TestParseFields|TestParseConsoleLine' -count=1`. Targeted integration: `cd pslogconsole2json && go test ./... -run 'TestProcessReader|TestFilter|TestOutputOrder' -count=1`. Regression boundary: converter typing, timestamp normalization, and filter correctness.
- [ ] P1 / Chunk 4: Add console fast/slow parity verification and line-hint stability controls. Scope: differential tests/fuzzing for runtime field encoders and replace monotonic max hint with bounded/decaying estimate. Unit tests: `go test ./... -run 'TestConsole.*Parity|TestConsole.*Hint' -count=1`. Targeted integration: `go test ./... -run 'TestConsoleVariants|TestLoggerVariants' -count=1`. Regression boundary: console rendering equivalence and allocation behavior.
- [ ] P1 / Chunk 5: Add JSON emitter parity harness and explicit non-finite float policy tests. Scope: cross-variant parity assertions for plain/color + static/non-static emitters and an option-backed policy for `NaN`/`Inf`. Unit tests: `go test ./... -run 'TestJSON.*Parity|TestJSON.*Float' -count=1`. Targeted integration: `go test ./... -run 'TestJSONEmit|TestLoggerVariants' -count=1`. Regression boundary: JSON schema consistency and emitter equivalence.
- [ ] P2 / Chunk 6: Tighten secure defaults for env output files and document behavior. Scope: move default output file mode toward least-privilege with explicit compatibility override and docs update. Unit tests: `go test ./... -run 'TestWriterFromEnvOutput.*|TestLoggerFromEnvOutput.*' -count=1`. Targeted integration: `go test ./... -run 'TestLoggerFromEnvOutputFile|TestLoggerFromEnvOutputDefaultTee' -count=1`. Regression boundary: deploy-time file accessibility and existing env-output workflows.
- [ ] Release gate: run full verification once after all chunks land together (`make check`, `go test ./... -race`, `go vet ./...`, and `cd pslogconsole2json && go test ./...`).
